---
title: Repository Improvement Plan (CLA Review)
this_file: REVIEW/TODO-cla.md
---

# Improvement Plan and Proposals

Context: This repo builds and hosts documentation for the FontLab 7 Python API and PythonQt using pydocmk2 (Python 2.7) and MkDocs Material. Below is a concrete, example-driven plan to improve maintainability, reproducibility, and contributor experience. No code changes are performed here; this document proposes them.

## Goals

- Reliable, one-command builds for both `fontlab7` and `pythonqt` docs.
- Clear separation of sources vs. generated artefacts; deterministic outputs.
- Modernized build path and CI to publish to GitHub Pages automatically.
- Contributor-friendly docs and CLA flow with examples and templates.

## Observations

- Generated HTML is committed in `docs/` and is large; rebuild steps require Python 2.7 and local FontLab to produce sources for MkDocs.
- Two parallel doc trees (`fontlab7/`, `pythonqt/`) have near-duplicate configuration and theme customizations.
- `README.md` focuses on manual builds; there’s no automated build script or CI.
- No `CONTRIBUTING.md`, PR/issue templates, or clear “generated vs. source” guidance.

## Proposed Improvements (with examples)

1) Build Automation (single entry point)
- Add a top-level task runner so contributors don’t memorize commands.
- Example Makefile snippet:
  ```make
  .PHONY: build build-fontlab7 build-pythonqt serve clean

  build: build-fontlab7 build-pythonqt

  build-fontlab7:
  	cd fontlab7/build && python2 -m mkdocs build -v -f ../mkdocs.yml --dirty

  build-pythonqt:
  	cd pythonqt/build && python2 -m mkdocs build -v -f ../mkdocs.yml --dirty

  serve:
  	cd fontlab7 && python2 -m mkdocs serve -f mkdocs.yml

  clean:
  	rm -rf docs/ docs/pythonqt/
  ```

2) Reproducible Environments
- Document pinned versions for MkDocs and theme used with Python 2 runtime (or ship a container).
- Example: `Dockerfile` to encapsulate the Python 2 toolchain and mkdocs build:
  ```Dockerfile
  FROM python:2.7-slim
  RUN pip install --no-cache-dir git+https://github.com/twardoch/pydocmk2 mkdocs==0.17.5 mkdocs-material==2.9.4
  WORKDIR /src
  CMD ["bash", "-lc", "cd fontlab7/build && python -m mkdocs build -f ../mkdocs.yml && cd ../../pythonqt/build && python -m mkdocs build -f ../mkdocs.yml"]
  ```
- Alternative: Prebuilt GH Actions setup using `actions/setup-python@v4` with a Python 2 toolchain (if available) or container job.

3) Generated Artefact Policy
- Treat `docs/` as build output; either:
  - Keep committed only on a dedicated `gh-pages` branch (preferred), or
  - Continue committing to `main`, but clarify that `docs/` is generated and add regeneration policy.
- Example README blurb:
  > The `docs/` directory is generated by MkDocs; do not edit HTML directly. Edit sources under `fontlab7/srcdocs` or `pythonqt/srcdocs`, then rebuild.

4) CI/CD for Publishing (GitHub Pages)
- Add a workflow that builds and deploys on tag or main branch updates.
- Example `.github/workflows/docs.yml` (container-based for Python 2):
  ```yaml
  name: Build and Deploy Docs
  on:
    push:
      branches: [ main ]
      tags: [ 'v*' ]
  jobs:
    build:
      runs-on: ubuntu-latest
      container: python:2.7-slim
      steps:
        - uses: actions/checkout@v3
        - run: pip install git+https://github.com/twardoch/pydocmk2 mkdocs==0.17.5 mkdocs-material==2.9.4
        - run: cd fontlab7/build && python -m mkdocs build -f ../mkdocs.yml
        - run: cd pythonqt/build && python -m mkdocs build -f ../mkdocs.yml || true
        - uses: actions/upload-pages-artifact@v3
          with:
            path: docs
    deploy:
      needs: build
      permissions:
        pages: write
        id-token: write
      environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
      runs-on: ubuntu-latest
      steps:
        - id: deployment
          uses: actions/deploy-pages@v4
  ```
- Note: The PythonQt build may be optional if its sources require a FontLab-installed environment. The MkDocs phase can still publish existing generated content.

5) Deduplicate and Centralize Theme/Config
- Extract shared MkDocs settings (extensions, analytics, palette, logo, extra_css) into a common YAML and anchor-merge them in both `mkdocs.yml` files.
- Example pattern (YAML anchors):
  ```yaml
  # common.yml
  x-theme: &theme
    name: material
    logo: https://.../icon-fontlab-7.png
    palette: { primary: indigo }
  x-markdown: &markdown_ext
    - attr_list
    - def_list
    - tables
    - pymdownx.superfences: { highlight_code: true }
  ```
- Then in `fontlab7/mkdocs.yml` and `pythonqt/mkdocs.yml`, import or copy-with-anchors to avoid drift.

6) Clear Source Structure and Examples
- Add short `README.md` files inside `fontlab7/srcdocs/` and `pythonqt/srcdocs/` describing:
  - Where to add hand-written docs (`docs/`), and how `pre/` and `post/` files work.
  - Concrete examples (e.g., `typerig.core.objects.cubicbezier.md` → pre/post pages) with a before/after snippet.
- Example guidance snippet:
  ```md
  To prepend content to an API page generated as `fontgate.fgGlyph.md`, create `srcdocs/pre/fontgate.fgGlyph.md` with an intro, usage example, and notes.
  ```

7) Contributor Experience and CLA Flow
- Add `CONTRIBUTING.md` with prerequisites, build commands, and CLA requirement.
- Add issue/PR templates to encourage adding `pre/`/`post/` docs and repro steps for build issues.
- Link CLA prominently in `README.md` and `CONTRIBUTING.md`.

8) Modernization Strategy (medium-term)
- Python 2.7 is EOL; plan a migration path:
  - Verify pydocmk2 compatibility with Python 3 (or alternatives like `pdoc`, `pdoc3`, `sphinx`, or mkdocstrings).
  - Prototype generating Markdown for a subset of modules with Python 3 toolchain; compare output.
  - If FontLab export step is the blocker, consider exporting intermediate JSON or reStructuredText and converting to Markdown with a Python 3 tool.

9) Housekeeping
- Ensure `.gitignore` excludes local caches and temporary files (e.g., `*.vfpyc`, `.DS_Store`, `site/`, `.pytest_cache/`).
- Add `CODE_OF_CONDUCT.md` and `SECURITY.md` for standardization.
- Add `mkdocs serve` instructions and a port note for local preview.

## Phased Plan

- Phase 0: Document status
  - Clarify in `README.md` what is generated vs. source; add regeneration and publishing policy.

- Phase 1: Automation
  - Add Makefile and a minimal CI workflow to build and publish existing docs to GitHub Pages.
  - Keep PythonQt build optional if data is not available in CI.

- Phase 2: Config hygiene
  - Deduplicate MkDocs config (anchors or a shared snippet). Consolidate custom CSS in a single source and symlink or copy as needed.

- Phase 3: Contributor enablement
  - Add `CONTRIBUTING.md`, templates, and `srcdocs/` READMEs with concrete examples.

- Phase 4: Modernization prototype
  - Spike a Python 3 build path for one module group using mkdocstrings or pdoc. Compare fidelity and decide on migration roadmap.

## Risks and Mitigations

- Python 2 toolchain availability: Use containerized builds to ensure longevity.
- FontLab dependency for generation: Capture generated Markdown in repo (not just HTML) to reduce reliance on local FontLab for every rebuild; document when regeneration is necessary.
- CI stability: Pin MkDocs and theme versions; test on a branch before switching Pages to Actions.

## Success Criteria

- `make build` (or one equivalent command) produces the same `docs/` artefacts deterministically on a clean machine.
- GitHub Pages deploys automatically on merges to `main`.
- Contributors can add/modify `pre/` and `post/` docs with clear guidance and examples.
- Reduced configuration drift between `fontlab7` and `pythonqt` trees.

